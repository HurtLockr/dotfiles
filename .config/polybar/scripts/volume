#!/bin/bash

# This script is used to detect the current audio sink, so the appropriate icon
# can be selected for the volume module

# detect if bluetooth sink
blue=$(pacmd list-sinks | grep -e 'name:' -e 'index:' -e 'muted:' -e 'volume:' | grep -A4 \*)
muted=`expr match "$blue" '.*muted: \(.*\).*'`
volume=`expr match "$blue" '.*volume: front-left:\ [0-9]*\ /\ *\([0-9]*%\).*'`
bluestr=`expr match "$blue" '.*name: <\([^\_]*\)\_.*'`

icon=墳

if [[ $bluestr == "bluez" ]] 
then 
    icon=
fi

# detect if headphones in
jackstr=$(amixer -c0 contents | grep -A2 numid=15)
jack=`expr match "$jackstr" '.*: values=\(.*\)'`

if [[ $jack == "on" ]] 
then
    icon=
fi

# if mute, then
if [[ $muted == "yes" ]]
then 
    vol="mute"
elif [[ $bluestr == "bluez" ]]
then 
    vol=""
else
    vol=$volume
fi

FIRST_SEP="%{B$POLYBAR_BACKGROUND}%{F$POLYBAR_COLOR5_LIGHT}%{T2}%{T-}%{F-}%{B-}"
FIRST="%{B$POLYBAR_COLOR5_LIGHT} $icon %{B-}"
MIDDLESEP="%{B$POLYBAR_COLOR5_LIGHT}%{F$POLYBAR_COLOR5}%{T2}%{T-}%{F-}%{B-}"
NET="%{B$POLYBAR_COLOR5} $vol %{B-}"
LAST="%{F$POLYBAR_BACKGROUND}%{B$POLYBAR_COLOR5}%{T2}%{T-}%{F-}%{B-}"
echo $FIRST_SEP$FIRST$MIDDLESEP$NET$LAST
